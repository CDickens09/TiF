<!DOCTYPE html>
<html>
    <head>
		<title>TiF</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://chris14552249.github.io/TiF/generalstyle.css">
		<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="https://unpkg.com/marked@0.3.6"></script>
		<script src="https://unpkg.com/lodash@4.16.0"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<style>
		</style>
	</head>

	<body>
		<!-- Placeholder and script to load navbar -->
		<div id="navigation-placeholder"></div>
		<script>
		$(function()
		{
			$("#navigation-placeholder").load("https://chris14552249.github.io/TiF/navigation.html");
		});
		</script>
		
		<!-- Header for page and link to instructions -->
		<div class="header">
			<h1>BlackBoard Question Pool Maker</h1>
			<p>
				To view instruction please visit the <a href="/TiF/Help">Help</a> page 
			</p>
		</div>
		
		<!-- Row to show button headers-->
		<div class="row">
			<div class="column bheaders">
				Number of Variables:
			</div>
		</div>
		
		<!-- Row to show Buttons-->
		<div class="row">
			<div class="column buttons">
				<!-- Box to input desired random number accuracy -->
				<input type="number" style="width:100%" id="NumVar" value="1" oninput="updatevar(this)">				
			</div>
		</div>
		
		<!-- Row for variable names to be set in-->
		<div class="row">
			<div id="Variable headers">
				<div>Variable 1:</div>
			</div>
		</div>
		
		<!-- Row for variable mins to be set in-->
		<div class="row">
			<div id="Variable mins">
				<div>Min: </div><input type="number" id="Var1min" value="0">
			</div>
		</div>
		
		<!-- Row for variable maxs to be set in-->
		<div class="row">
			<div id="Variable maxs">
				<div>Max: </div><input type="number" id="Var1max" value="1">				
			</div>
		</div>
		
		<!-- Row for variable decimal accuracies to be set in-->
		<div class="row">
			<div id="Variable decs">
				<div>Decimals: </div><input type="number" id="Var1dec" value="2">				
			</div>
		</div>
		
		<!-- Row to show question box headers-->
		<div class="row">
			<div class="column iheaders">
				Question Input:
			</div>
			<div class="column iheaders">
				Question Output:
			</div>
		</div>
		
		<!-- Row to show question boxs-->
		<div class="row">
			<div class="column inputs">
				<div id="questions">
					<textarea id = "QInput" :value="input" @input="update" oninput = "update(this)"></textarea>
					<div id = "QMarked" style="overflow:auto" v-html="compiledMarkdown"></div>
				</div>
			</div>
		</div>

		<!-- Row to show answer box headers-->
		<div class="row">
			<div class="column iheaders">
				Answer Input:
			</div>
			<div class="column iheaders">
				Answer Output:
			</div>
		</div>
		
		<!-- Row to show answer boxs-->
		<div class="row">
			<div class="column inputs">
				<div id="answers">
					<textarea id = "AInput" :value="input" @input="update" oninput = "update(this)"></textarea>
					<div id = "AMarked" style="overflow:auto" v-html="compiledMarkdown"></div>
				</div>
			</div>
			<div class="column buttons">
				<!-- Button to initiate download -->
				<input style="width:100%" id="DownloadButton" type="button" value="Download" onclick="OutputFile();" />
			</div>
		</div>

		<script>
			function updatevar(box)
			{
				var newnumvar = box.value;
				if(numvar == newnumvar)
				{
					
				}
				else
				{
					numvar = newnumvar;
				}
				
				console.log(numvar);
			}
			
			function Random()
			{
				// Adds random string to input box
				document.getElementById("QInput").value = document.getElementById("QInput").value + "random";
			}
			
			function Convert(input, output)
			{
				// Brings in current output from question output box
				var value = document.getElementById(input).value
				document.getElementById(output).value = value;
				while (value.search("random") !== -1)
				{
					// Finds index for random value identifier
					var index = value.search("random");
					// Brings in accuracy for random variables
					var acc = document.getElementById("RandomAccuracy").value;
					// Creates new string with random variable added
					value = value.substr(0, index) + Math.random().toFixed(acc) + value.substr(index + 6);
					document.getElementById(output).value = value;
				}
			}	
			
			function update(box)
			{
				// If loop to check whether the box being updated is the question or answer row
				if (box.id.search("Q") == -1)
				{
					var input = "AInput";
					var output = "AConverted";
				}
				else 
				{
					var input = "QInput";
					var output = "QConverted";
				}
				// Runs the convert function with the desired input and outputs
				Convert(input, output)
			}
			
			function OutputFile()
			{
				// Brings in Output from converted box
				var Output = document.getElementById("Converted").value;
				// Creates temporary blob file
				var File = new Blob([Output], {type:'text/plain'});
				// Provides file name for file
				var FileName = "test.dat";
				//Creates download element
				var Download = document.createElement("a");
				Download.download = FileName;
				Download.innerHTML = "Download File";
				// For all browsers except Firefox
				if (window.URL != null)
				{
					Download.href = window.URL.createObjectURL(File);
				}
				// For Firefox browser to work
				else
				{
					Download.href = window.URL.createObjectURL(File);
					Download.onclick = destroyClickedElement;
					Download.style.display = "none";
					document.body.appendChild(Download);
				}
				// Starts download of file
				Download.click();
			}
			
			// Uses vue element to live update the question boxes
			new Vue({
				el: '#questions',
				data: {
					input: ''
				},
				computed: {
					compiledMarkdown: function () {
						return marked(this.input, { sanitize: true });
					}
				},
				methods: {
					update: _.debounce(function (e) {
						this.input = e.target.value
					}, 300)
				}
			})
			
			// Uses vue element to live update the answer boxes
			new Vue({
				el: '#answers',
				data: {
					input: ''
				},
				computed: {
					compiledMarkdown: function () {
						return marked(this.input, { sanitize: true });
					}
				},
				methods: {
					update: _.debounce(function (e) {
						this.input = e.target.value
					}, 300)
				}
			})
		</script>
		
		<!-- Placeholder and script to load footer -->
		<div id="footer-placeholder"></div>
		<script>
		$(function()
		{
			$("#footer-placeholder").load("https://chris14552249.github.io/TiF/footer.html");
		});
		</script>
	</body>
</html>
